#!/bin/sh

if [ "$1" = "-a" ]; then
  case `uname -s` in
    "Darwin")
      lsof -i -n | \
        awk '$9 !~ /127.0.0.1/ { $4=$5=$6=$7=$8=""; print }' | \
        column -t
      ;;
    "FreeBSD")
      sockstat -46L | \
        awk '{ $4=""; print }' | \
        column -t
      ;;
  esac
else
  case `uname -s` in
    "Darwin")
      lsof -i -n | \
        awk '$9 ~ /([0-9]{1,3}\.){3}[0-9]/ && !/127.0.0.1/ { $4=$5=$6=$7=$8=""; print }' | \
        column -t
      ;;
    "FreeBSD")
      sockstat -46L | \
        awk '$7 ~ /[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+/ && !/127.0.0.1/ { $4=""; print }' | \
        column -t
      ;;
  esac
fi

